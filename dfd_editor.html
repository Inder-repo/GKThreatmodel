
#### 2. Drag-and-Drop Editor (`dfd_editor.html`)
This HTML/JavaScript file is optimized to reduce DOM manipulation and debounce updates sent to Streamlit, improving performance.

<xaiArtifact artifact_id="442a948b-504d-460e-9ca5-5a64ec0c6f15" artifact_version_id="9dab2792-2be7-4423-8f9f-3733e1b08eab" title="dfd_editor.html" contentType="text/html">
```html
<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin: 0; font-family: Arial; }
        .toolbar { background: #f0f0f0; padding: 5px; border-bottom: 1px solid #ccc; }
        .toolbar button { margin: 3px; padding: 5px; cursor: move; }
        .canvas { width: 600px; height: 300px; border: 1px solid #000; position: relative; background: #fff; }
        .canvas.dark { background: #2a2a2a; }
        .element { position: absolute; border: 1px solid #000; text-align: center; line-height: 20px; cursor: move; font-size: 12px; }
        .process { width: 40px; height: 40px; border-radius: 50%; background: #aaffaa; }
        .data-store { width: 80px; height: 30px; background: #aaaaff; }
        .external-entity { width: 80px; height: 30px; background: #ffaaaa; }
        .selected { border: 2px solid red; }
        svg { position: absolute; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div class="toolbar">
        <button draggable="true" data-type="Process">Process</button>
        <button draggable="true" data-type="Data Store">Data Store</button>
        <button draggable="true" data-type="External Entity">Entity</button>
        <button onclick="startDrawingArrow()">Data Flow</button>
        <button onclick="clearCanvas()">Clear</button>
    </div>
    <div id="canvas" class="canvas"></div>
    <svg id="arrows"></svg>
    <script>
        let elements = [];
        let arrows = [];
        let selectedElement = null;
        let drawingArrow = false;
        let arrowStart = null;
        let lastUpdate = 0;
        const canvas = document.getElementById('canvas');
        const arrowsSvg = document.getElementById('arrows');

        // Apply theme
        canvas.classList.toggle('dark', '{{THEME}}' === 'dark');

        // Drag and drop
        document.querySelectorAll('.toolbar button').forEach(button => {
            button.addEventListener('dragstart', e => e.dataTransfer.setData('type', e.target.dataset.type));
        });

        canvas.addEventListener('dragover', e => e.preventDefault());
        canvas.addEventListener('drop', e => {
            e.preventDefault();
            const type = e.dataTransfer.getData('type');
            if (type && type !== 'Data Flow') {
                const id = 'elem_' + Date.now();
                const x = e.offsetX - (type === 'Process' ? 20 : 40);
                const y = e.offsetY - (type === 'Process' ? 20 : 15);
                const width = type === 'Process' ? 40 : 80;
                const height = type === 'Process' ? 40 : 30;
                const element = { id, type, name: type + '_' + elements.length, x, y, width, height, technology: '', data_flow: '' };
                elements.push(element);
                addElementToCanvas(element);
                sendDataToStreamlit();
            }
        });

        function addElementToCanvas(element) {
            const div = document.createElement('div');
            div.id = element.id;
            div.className = `element ${element.type.toLowerCase().replace(' ', '-')}`;
            div.style.left = element.x + 'px';
            div.style.top = element.y + 'px';
            div.style.width = element.width + 'px';
            div.style.height = element.height + 'px';
            div.innerText = element.name;
            div.draggable = true;
            div.addEventListener('dragstart', e => e.dataTransfer.setData('id', element.id));
            div.addEventListener('click', () => selectElement(element.id));
            canvas.appendChild(div);
        }

        canvas.addEventListener('dragover', e => e.preventDefault());
        canvas.addEventListener('drop', e => {
            e.preventDefault();
            const id = e.dataTransfer.getData('id');
            const element = elements.find(el => el.id === id);
            if (element) {
                element.x = e.offsetX - element.width / 2;
                element.y = e.offsetY - element.height / 2;
                document.getElementById(id).style.left = element.x + 'px';
                document.getElementById(id).style.top = element.y + 'px';
                updateArrows();
                sendDataToStreamlit();
            }
        });

        function selectElement(id) {
            if (selectedElement) document.getElementById(selectedElement).classList.remove('selected');
            selectedElement = id;
            document.getElementById(id).classList.add('selected');
            sendDataToStreamlit();
        }

        function startDrawingArrow() {
            drawingArrow = true;
            canvas.addEventListener('click', handleArrowClick);
        }

        function handleArrowClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const element = elements.find(el => 
                x >= el.x && x <= el.x + el.width && 
                y >= el.y && y <= el.y + el.height && 
                el.type !== 'Data Flow'
            );
            if (element) {
                if (!arrowStart) {
                    arrowStart = element;
                } else if (element !== arrowStart) {
                    const arrow = {
                        id: 'arrow_' + Date.now(),
                        source: arrowStart.name,
                        target: element.name,
                        type: 'Data Flow',
                        name: 'Flow_' + arrows.length,
                        data_flow: 'Data Flow'
                    };
                    arrows.push(arrow);
                    drawArrow(arrow);
                    arrowStart = null;
                    drawingArrow = false;
                    canvas.removeEventListener('click', handleArrowClick);
                    sendDataToStreamlit();
                }
            }
        }

        function drawArrow(arrow) {
            const source = elements.find(el => el.name === arrow.source);
            const target = elements.find(el => el.name === arrow.target);
            if (source && target) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('id', arrow.id);
                line.setAttribute('x1', source.x + source.width / 2);
                line.setAttribute('y1', source.y + source.height / 2);
                line.setAttribute('x2', target.x + target.width / 2);
                line.setAttribute('y2', target.y + target.height / 2);
                line.setAttribute('stroke', 'black');
                line.setAttribute('stroke-width', '1');
                line.setAttribute('marker-end', 'url(#arrowhead)');
                arrowsSvg.appendChild(line);
            }
        }

        function updateArrows() {
            arrowsSvg.innerHTML = '<defs><marker id="arrowhead" markerWidth="8" markerHeight="5" refX="8" refY="2.5" orient="auto"><polygon points="0 0, 8 2.5, 0 5" /></marker></defs>';
            arrows.forEach(drawArrow);
        }

        function clearCanvas() {
            elements = [];
            arrows = [];
            canvas.innerHTML = '';
            arrowsSvg.innerHTML = '<defs><marker id="arrowhead" markerWidth="8" markerHeight="5" refX="8" refY="2.5" orient="auto"><polygon points="0 0, 8 2.5, 0 5" /></marker></defs>';
            sendDataToStreamlit();
        }

        function sendDataToStreamlit() {
            if (Date.now() - lastUpdate < 1000) return; // Debounce updates (1-second delay)
            lastUpdate = Date.now();
            window.Streamlit.setComponentValue({ elements: elements.concat(arrows), selected: selectedElement });
        }

        window.addEventListener('message', e => {
            if (e.data.type === 'LOAD_ELEMENTS') {
                elements = e.data.elements.filter(el => el.type !== 'Data Flow');
                arrows = e.data.elements.filter(el => el.type === 'Data Flow');
                canvas.innerHTML = '';
                arrowsSvg.innerHTML = '<defs><marker id="arrowhead" markerWidth="8" markerHeight="5" refX="8" refY="2.5" orient="auto"><polygon points="0 0, 8 2.5, 0 5" /></marker></defs>';
                elements.forEach(addElementToCanvas);
                arrows.forEach(drawArrow);
                sendDataToStreamlit();
            }
        });
    </script>
</body>
</html>
```
