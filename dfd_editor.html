```html
<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        .toolbar { background: #f0f0f0; padding: 10px; border-bottom: 1px solid #ccc; }
        .toolbar button { margin: 5px; padding: 8px; cursor: move; }
        .canvas { width: 800px; height: 400px; border: 1px solid #000; position: relative; background: #fff; }
        .canvas.dark { background: #2a2a2a; }
        .element { position: absolute; border: 1px solid #000; text-align: center; line-height: 30px; cursor: move; }
        .process { width: 60px; height: 60px; border-radius: 50%; background: #aaffaa; }
        .data-store { width: 100px; height: 40px; background: #aaaaff; }
        .external-entity { width: 100px; height: 40px; background: #ffaaaa; }
        .trust-boundary { border: 2px dashed #000; background: none; }
        .selected { border: 2px solid red; }
        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div class="toolbar">
        <button draggable="true" data-type="Process">Process</button>
        <button draggable="true" data-type="Data Store">Data Store</button>
        <button draggable="true" data-type="External Entity">External Entity</button>
        <button draggable="true" data-type="Trust Boundary">Trust Boundary</button>
        <button onclick="startDrawingArrow()">Data Flow</button>
        <button onclick="clearCanvas()">Clear Canvas</button>
    </div>
    <div id="canvas" class="canvas"></div>
    <svg id="arrows"></svg>
    <script>
        let elements = [];
        let arrows = [];
        let selectedElement = null;
        let drawingArrow = false;
        let arrowStart = null;
        const canvas = document.getElementById('canvas');
        const arrowsSvg = document.getElementById('arrows');

        // Apply theme
        function applyTheme(theme) {
            canvas.classList.toggle('dark', theme === 'dark');
        }
        applyTheme('{{THEME}}');

        // Drag and Drop
        document.querySelectorAll('.toolbar button').forEach(button => {
            button.addEventListener('dragstart', e => e.dataTransfer.setData('type', e.target.dataset.type));
        });

        canvas.addEventListener('dragover', e => e.preventDefault());
        canvas.addEventListener('drop', e => {
            e.preventDefault();
            const type = e.dataTransfer.getData('type');
            if (type && type !== 'Data Flow') {
                const id = 'elem_' + Date.now();
                const x = e.offsetX - (type === 'Process' ? 30 : 50);
                const y = e.offsetY - (type === 'Process' ? 30 : 20);
                const width = type === 'Trust Boundary' ? 150 : (type === 'Process' ? 60 : 100);
                const height = type === 'Trust Boundary' ? 100 : (type === 'Process' ? 60 : 40);
                const element = { id, type, name: type + '_' + elements.length, x, y, width, height, technology: '', data_flow: '', trust_boundary: '' };
                elements.push(element);
                addElementToCanvas(element);
                sendDataToStreamlit();
            }
        });

        function addElementToCanvas(element) {
            const div = document.createElement('div');
            div.id = element.id;
            div.className = `element ${element.type.toLowerCase().replace(' ', '-')}`;
            div.style.left = element.x + 'px';
            div.style.top = element.y + 'px';
            div.style.width = element.width + 'px';
            div.style.height = element.height + 'px';
            div.innerText = element.name;
            div.draggable = true;
            div.addEventListener('dragstart', e => e.dataTransfer.setData('id', element.id));
            div.addEventListener('click', () => selectElement(element.id));
            canvas.appendChild(div);
        }

        canvas.addEventListener('dragover', e => e.preventDefault());
        canvas.addEventListener('drop', e => {
            e.preventDefault();
            const id = e.dataTransfer.getData('id');
            const element = elements.find(el => el.id === id);
            if (element) {
                element.x = e.offsetX - element.width / 2;
                element.y = e.offsetY - element.height / 2;
                document.getElementById(id).style.left = element.x + 'px';
                document.getElementById(id).style.top = element.y + 'px';
                updateArrows();
                sendDataToStreamlit();
            }
        });

        function selectElement(id) {
            if (selectedElement) document.getElementById(selectedElement).classList.remove('selected');
            selectedElement = id;
            document.getElementById(id).classList.add('selected');
            window.Streamlit.setComponentValue({ selected: id });
        }

        function startDrawingArrow() {
            drawingArrow = true;
            canvas.addEventListener('click', handleArrowClick);
        }

        function handleArrowClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const element = elements.find(el => 
                x >= el.x && x <= el.x + el.width && 
                y >= el.y && y <= el.y + el.height && 
                el.type !== 'Trust Boundary' && el.type !== 'Data Flow'
            );
            if (element) {
                if (!arrowStart) {
                    arrowStart = element;
                } else if (element !== arrowStart) {
                    const arrow = {
                        id: 'arrow_' + Date.now(),
                        source: arrowStart.name,
                        target: element.name,
                        type: 'Data Flow',
                        name: 'Data Flow_' + arrows.length,
                        data_flow: 'Data Flow'
                    };
                    arrows.push(arrow);
                    drawArrow(arrow);
                    arrowStart = null;
                    drawingArrow = false;
                    canvas.removeEventListener('click', handleArrowClick);
                    sendDataToStreamlit();
                }
            }
        }

        function drawArrow(arrow) {
            const source = elements.find(el => el.name === arrow.source);
            const target = elements.find(el => el.name === arrow.target);
            if (source && target) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('id', arrow.id);
                line.setAttribute('x1', source.x + source.width / 2);
                line.setAttribute('y1', source.y + source.height / 2);
                line.setAttribute('x2', target.x + target.width / 2);
                line.setAttribute('y2', target.y + target.height / 2);
                line.setAttribute('stroke', 'black');
                line.setAttribute('stroke-width', '2');
                line.setAttribute('marker-end', 'url(#arrowhead)');
                arrowsSvg.appendChild(line);
            }
        }

        function updateArrows() {
            arrowsSvg.innerHTML = '<defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" /></marker></defs>';
            arrows.forEach(drawArrow);
        }

        function clearCanvas() {
            elements = [];
            arrows = [];
            canvas.innerHTML = '';
            arrowsSvg.innerHTML = '<defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" /></marker></defs>';
            sendDataToStreamlit();
        }

        function sendDataToStreamlit() {
            window.Streamlit.setComponentValue({ elements: elements.concat(arrows) });
        }

        function loadElements(dfd_elements) {
            elements = dfd_elements.filter(el => el.type !== 'Data Flow');
            arrows = dfd_elements.filter(el => el.type === 'Data Flow');
            canvas.innerHTML = '';
            arrowsSvg.innerHTML = '<defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" /></marker></defs>';
            elements.forEach(addElementToCanvas);
            arrows.forEach(drawArrow);
            sendDataToStreamlit();
        }

        // Load initial elements from Streamlit
        window.addEventListener('message', e => {
            if (e.data.type === 'LOAD_ELEMENTS') {
                loadElements(e.data.elements);
            }
        });
    </script>
</body>
</html>
```
